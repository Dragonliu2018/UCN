# 第7章 异常控制流

## 0x03 讨论区

### 01. 进程切换、工作模式切换及过程调用切换

* **问**：第7章我们学习了进程切换，还有当发生异常和中断时，系统会从用户态转到内核态执行，第3章我们还学过过程调用，也可以看作是过程间的切换，你觉得这些切换或转换之间有没有什么共性？它们之间的区别又有哪些呢？
* **答**：
  * 共性：都需要保存现场；过程调用切换：栈帧记录了过程调用时的状态；工作模式切换：陷阱帧记录了用户进程触发异常时现场的状态，用以将来恢复现场。
  * 区别
    * 函数调用时需要保存：返回地址，调用者保存寄存器；异常和中断时需要保存：通用寄存器， EFLAGS, CS, EIP，错误码，异常号。过程调用保存的信息较发生异常和中断保存的信息少。
    * 函数调用时不切换特权等级，在原来的栈帧中进行；进行异常处理时，系统从用户态转到内核态执行，切换了栈帧。
    * 传参方式不同：系统级函数的参数由通用寄存器传递，EAX包含系统调用号，EBX、ECX、EDX、ESI、EDI、EBP包含最多六个任意的参数；用户级函数的参数通过ESP指示传参；
    * 系统调用运行在内核模式，允许执行内核模式的指令，并访问定义在内核中的栈。

